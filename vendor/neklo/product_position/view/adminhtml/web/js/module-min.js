require(["prototype","NEKLOvendor"],function(){!function(){var t={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll|keyup)$/,MouseEvents:/^(?:click|mouse(?:down|up|over|move|out))$/},e={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0};Event.simulate=function(n,i){var a,s=Object.extend(e,arguments[2]||{}),r=null;n=$(n);for(var o in t)if(t[o].test(i)){r=o;break}if(!r)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");return document.createEvent?(a=document.createEvent(r),"HTMLEvents"==r?a.initEvent(i,s.bubbles,s.cancelable):a.initMouseEvent(i,s.bubbles,s.cancelable,document.defaultView,s.button,s.pointerX,s.pointerY,s.pointerX,s.pointerY,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.button,n),n.dispatchEvent(a)):(s.clientX=s.pointerX,s.clientY=s.pointerY,a=Object.extend(document.createEventObject(),s),n.fireEvent("on"+i,a)),n},Element.addMethods?Element.addMethods({simulate:Event.simulate}):(jQuery,console.log("Invalid install"))}(),function(t,e){function n(t){this.options=t||{}}t.NEKLO=t.NEKLO||{},t.NEKLO.Connectors={},n.prototype={$getPage:function(t,e,n,i){var a=this;return new Ajax.Request(this.options.url+"?isAjax=true",{parameters:{page:t,form_key:this.options.form_key,count:e},onSuccess:function(t){var e=a.$parseResponse(t);return n&&"function"==typeof n?n(e):e},onFailure:function(t){return i&&"function"==typeof i?i(t):t}})},$parseResponse:function(t){return t.responseJSON},$save:function(t){return t}},t.NEKLO.Connectors.Magento2Connector=n}(window,jQuery),function(t){function e(){}t.NEKLO=t.NEKLO||{},e.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},emit:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},e.mixin=function(t){for(var n=["on","off","emit"],i=0;i<n.length;i++)"function"==typeof t?t.prototype[n[i]]=e.prototype[n[i]]:t[n[i]]=e.prototype[n[i]];return t},t.NEKLO.SimpleEventEmitter=e}(window),function(t,e,n,i){function a(t,i,a,s){this.setups=t,this.parent=a;var r=e.createElement(t.selector),o=n.template(t.template)(i),d=new Image;return d.src=i.image,d.onload=s,d.onerror=s,r.className=t.className,r.style.width=t.width,r.style.marginBottom=t.margin,r.innerHTML=o,this.dataset=i,r.dataset.position=i.position,r.dataset.entity_id=i.entity_id,r.dataset.attached=!0===i.attached||"true"===i.attached,r.dataset.isDirty=!0===i.isDirty||"true"===i.isDirty,r.addEventListener("click",this.eventClick,!1),addEvent(r,"dragstart",this.eventDragStart),addEvent(r,"dragenter",this.eventDragEnter),addEvent(r,"dragover",this.eventDragOver),addEvent(r,"drop",this.eventDrop),addEvent(r,"dragend",this.eventDragEnd),r.$$instance=this,r.$$instance.getElement=function(){return r},r}function s(t){this.options=t,this.separatorElements=[],this.dragElement=null,this.page=1;var n=e.createElement(t.list.selector);return n.className=t.list.className,n.style.marginLeft=t.list.margin,n.style.width=t.grid.cols*(parseInt(t.item.width)+parseInt(t.item.margin))+"px",n.$$instance=this,n.$$instance.getListElement=function(){return n},n}function r(t){this.options=t;var n=t.uploadButton,i=e.createElement(n.selector);return i.className=n.className,i.innerHTML=n.label,i.$$instance=this,i.$$instance.getElement=function(){return i},i.addEventListener("click",this.uploadPage,!1),i}function o(t){t=t||{};var a=this;this.dataStoring=[],this.totalItems=t.totalItems,this.page=1,delete t.totalItems,this.options=n.merge(this.options,t);var d=+this.options.grid.cols*+this.options.grid.rows;return i(e).bind("myPageLoadedEvent",a.afterLoadPage),this.options.connector.$getPage(this.page,d,function(t){var n=a.options,d=n.targetDOM;if(!t.length)return o.createErrorElement(n);var l=new s(n),c=new r(n);l.$$instance.sorter=a,d.appendChild(l),d.parentNode.appendChild(c),l.$$instance.updateList(t,n.item),l.$$instance.addSeparators(),c.$$instance.updateState(a.page,a.totalItems),c.$$instance.updateWidth(l),d.$$instance=a,c.$$instance.onUploadPage=a.uploadPage.bind(a),a.onUploadedPage=function(t){l.$$instance.removeSeparators(),l.$$instance.updateList(t,n.item),l.$$instance.addSeparators(),c.$$instance.updateState(a.page,a.totalItems),i(e).trigger("myPageLoadedEvent",[a])},l.$$instance.onListUpdated=a.updateDataStoring.bind(a),i(e).trigger("myPageLoadedEvent",[a])},function(e){o.createErrorElement(t,e)}),this}t.NEKLO=t.NEKLO||{},a.prototype={getParentInstance:function(){return this.getElement().$$instance.parent.$$instance},isAttached:function(){return"true"===this.getElement().dataset.attached},searchElementSibling:function(t,e){if(t)return"true"!==t.dataset.attached&&t.classList.contains(this.setups.className)?t:"next"===e?this.searchElementSibling(t.nextSibling,e):this.searchElementSibling(t.previousSibling,e)},updateElementState:function(t,e){var n=this.getElement(),i=this.setups.states;n.style.height=e+"px",n.dataset.position=t.position,n.dataset.entity_id=t.entity_id,n.dataset.attached=!0===t.attached||"true"===t.attached,n.dataset.isDirty=!0===t.isDirty||"true"===t.isDirty,!0===t.attached||"true"===t.attached?(n.classList.add(i.attached),n.setAttribute("draggable",!1)):(n.classList.remove(i.attached),n.setAttribute("draggable",!0));var a=this.searchElementSibling(n.previousSibling,"previous"),s=this.searchElementSibling(n.nextSibling,"next");a?n.classList.remove(i.disableLeft):n.classList.add(i.disableLeft),s?n.classList.remove(i.disableRight):n.classList.add(i.disableRight)},eventClick:function(t){t.preventDefault&&t.preventDefault();var e=t.target,n=e.getAttribute("btn")||e.parentNode.getAttribute("btn");return"attached"===n&&this.$$instance.handlerAttach.bind(this)(),"toLeft"===n&&this.$$instance.handlerToLeft.bind(this)(),"toBegin"===n&&this.$$instance.handlerToBegin.bind(this)(),"toRight"===n&&this.$$instance.handlerToRight.bind(this)(),"toEnd"===n&&this.$$instance.handlerToEnd.bind(this)(),"toPage"===n&&null===e.closest(".nd-list__item.attached")&&this.$$instance.handlerToPage.bind(this)(),"goToPage"===n&&this.$$instance.handlerGoToPage.bind(this)(),"input"!=e.tagName.toLowerCase()&&null===n&&this.$$instance.handlerToPageReset.bind(this)(),!1},eventDragStart:function(t){this.$$instance.getParentInstance().setDragElement(this),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",this.innerHTML),this.style.opacity="0.5"},eventDragOver:function(t){return t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect="move",!1},eventDragEnter:function(t){t.preventDefault&&t.preventDefault();var e=this.$$instance.getParentInstance(),n=e.getListElements(),i=this.$$instance.setups.states;return[].forEach.call(n,function(t){t.classList.remove(i.over)}),this.classList.add(i.over),!1},eventDrop:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation();var e=this.$$instance.getParentInstance(),n=e.getDragElement(),i=this;return this.$$instance.handlerMoving(n,i),!1},eventDragEnd:function(t){var e=this.$$instance.getParentInstance(),n=e.getListElements(),i=this.$$instance.setups.states;[].forEach.call(n,function(t){t.classList.remove(i.over)}),this.style.opacity="1"},handlerToLeft:function(){var t=this.$$instance.getParentInstance(),e=this.$$instance.searchElementSibling(this.previousSibling,"previous");if(e){var n=+e.dataset.position,i=+this.dataset.position;t.sortElements(n,i,this,!1)}},handlerToRight:function(){var t=this.$$instance.getParentInstance(),e=this.$$instance.searchElementSibling(this.nextSibling,"next");if(e){var n=+this.dataset.position,i=+e.dataset.position;t.sortElements(n,i,this,!0)}},handlerToBegin:function(){var t=this.$$instance.getParentInstance(),e=t.getListElements(),i=n.find(e,function(t){return t.dataset&&"false"==t.dataset.attached});if(i&&i!==this){var a=+i.dataset.position,s=+this.dataset.position;t.sortElements(a,s,this,!1)}},handlerToEnd:function(){var t=this.$$instance.getParentInstance(),e=n.slice(t.getListElements()).reverse(),i=n.find(e,function(t){return t.dataset&&"false"==t.dataset.attached});if(i&&i!==this){var a=+this.dataset.position,s=+i.dataset.position;t.sortElements(a,s,this,!0)}},handlerToPageReset:function(){return i(this).find(".to-page-frm").css({display:"none"}),i(this).find(".to-page-inp").prop("disabled",!0),!1},handlerGoToPage:function(t){var e=this;void 0==this.parent&&(t=this,e=t.$$instance);var a=i(t).find(".to-page-inp").val(),s=t.$$instance.getParentInstance(),r=s.sorter;if(""!==a&&(a=parseInt(a))>=1)if(r.page<a)r.pageSkip=!0,r.uploadPage(e.handlerGoToPage.bind(t));else{r.pageSkip=!1;var o=+r.options.grid.cols*+r.options.grid.rows*(a-1);o+=1;var d=n.toArray(s.getListElement().select(".nd-list__item")).slice(o),l=n.find(d,"dataset.attached","false");if(!l||l===this)return;var c=+l.dataset.position,p=+t.dataset.position,h=!1;c>p&&(o=c,c=p,p=o,h=!0);i(t).find(".to-page-frm").css({display:"none"});s.sortElements(c,p,t,h)}},handlerToPage:function(){var t=this,e=this.$$instance,n=t.$$instance.getParentInstance(),a=n.sorter,s=(a.totalItems/(+a.options.grid.cols*+a.options.grid.rows)).ceil();if(1==s)return void alert("No page to move to");var r=i(this).find(".to-page-frm");if(!i(this).attr("my-initialized")){var o=i(this).find(".to-page-inp");o.click(function(t){return t.preventDefault(),!1}),o.length&&e.addPageOptions(o,s),i(this).attr("my-initialized",!0)}i(this).find(".to-page-inp").prop("disabled",!1),r.css({display:"block"})},addPageOptions:function(t,e,n){for(var i=1;i<=e;i++)t.append('<option value="'+i+'"'+(n===i?' selected="selected"':"")+">"+i+"</option>")},handlerMoving:function(t,e){if(t==e||e.$$instance.isAttached())return!1;var n,i,a,s=t.$$instance.getParentInstance();+t.dataset.position>+e.dataset.position?(n=+e.dataset.position,i=+t.dataset.position,a=!1):(n=+t.dataset.position,i=+e.dataset.position,a=!0),s.sortElements(n,i,t,a)},handlerAttach:function(){var t=this.$$instance.getParentInstance();this.dataset.isDirty=!0,this.dataset.attached="true"!==this.dataset.attached&&!0!==this.dataset.attached,t.updateElementsState(),t.onListUpdated([this])}},t.NEKLO.SorterElement=a,s.prototype={getOptions:function(){return this.options},getListElements:function(){return this.getListElement().childNodes},getDragElement:function(){return this.dragElement},setDragElement:function(t){this.dragElement=t},addSeparators:function(){for(var t=this.getOptions(),i=t.separator,a=this.getListElements(),s=this.getListElement(),r=a.length,o=t.grid.cols*t.grid.rows,d=[],l=i.template,c=0;c<r;c++)c%o!=0&&0!==c||d.push(a[c]);n.forEach(d,function(t,a){a++;var r=e.createElement(i.selector);r.className=i.className,r.innerHTML=n.template(l)({value:a}),s.insertBefore(r,t),s.$$instance.separatorElements.push(r)})},removeSeparators:function(){var t=this.getListElement();n.forEach(t.$$instance.separatorElements,function(e){t.removeChild(e)}),t.$$instance.separatorElements=[]},sortElements:function(t,e,i,a){var s=this,r=t-1,o=e-1;this.removeSeparators();var d,l=this.getListElements();l=n.slice(l,r,o+1);var c=n.clone(l,!0);a?(d=e,l=l.reverse()):d=t,l=this.sortElementsByOrder(l,i,d),s.sortElementsInDOM(l,c),s.updateElementsState(),s.addSeparators(),s.onListUpdated(l)},sortElementsByOrder:function(t,e,i){var a;return n.forEach(t,function(t){t.$$instance.isAttached()||(t.dataset.isDirty=!0,a&&(a.dataset.position=t.dataset.position),a=t,t.dataset.entity_id===e.dataset.entity_id&&(t.dataset.position=i))}),t.sort(function(t,e){return+t.dataset.position-+e.dataset.position}),t},sortElementsInDOM:function(t,i){var a=this.getListElement(),s=e.createElement("li");a.insertBefore(s,i[0]),n.forEach(i,function(t){a.removeChild(t)}),n.forEach(t,function(t){a.insertBefore(t,s)}),a.removeChild(s)},updateList:function(t,e){if(!t||!Array.isArray(t))throw new Error("You can update list of elements with pass data like array");if(t.length){return this.createListItems(t,e)}},createListItems:function(t,e){function n(){++d===r&&i.updateElementsState()}var i=this,s=0,r=t.length,o=this.getListElement(),d=0;for(s;s<r;s++){var l=new a(e,t[s],o,n);o.appendChild(l)}return o},updateElementsState:function(){var t=this.getOptions().separator,e=this.getListElements(),i=0;n.forEach(e,function(t){t.clientHeight>i&&(i=t.clientHeight)}),n.forEach(e,function(e){e.classList.contains(t.className)||e.$$instance.updateElementState(e.dataset,i)})}},t.NEKLO.SorterList=s,r.prototype={uploadPage:function(t){t.preventDefault(),this.$$instance.onUploadPage()},updateState:function(t,e){var n=this.options,i=n.grid.cols;t*n.grid.rows*i>=e&&(this.getElement().style.display="none")},updateWidth:function(t){this.getElement()}},o.createErrorElement=function(t,n){var i=t.targetDOM,a=t.error,s=e.createElement(a.selector);s.className=a.className,s.innerHTML=n||a.message,i.appendChild(s)},o.EVENTS={ON_ITEMS_CHANGED:"ProductSorter:ON_ITEMS_CHANGED"},o.prototype={EVENTS:o.EVENTS,options:{targetDOM:e.querySelector("body"),grid:{cols:5,rows:2},uploadButton:{label:"Upload Next Page",className:"nd-btn upload",selector:"button"},error:{className:"nd-list__error",selector:"div",message:"Empty data"},list:{className:"nd-list",selector:"ul"},item:{className:"nd-list__item",selector:"li",width:"166px",margin:"20px",template:"<span>Say Hello</span>",states:{attached:"attached",disableLeft:"disableLeft",disableRight:"disableRight",over:"over"}},separator:{className:"nd-list__separator",selector:"li",template:""}},getDataStoring:function(){return this.dataStoring},updateDataStoring:function(t){var e=this.getDataStoring(),i=[];n.forEach(t,function(t){if("true"===t.dataset.isDirty){var a=t.dataset,s=n.find(e,"entity_id",a.entity_id);s?s=a:e.push(a),i.push(a)}}),this.emit&&this.emit(this.EVENTS.ON_ITEMS_CHANGED,i)},uploadPage:function(t){var e=this,n=this.options,i=n.grid.cols,a=n.grid.rows,s=+i*+a;n.connector.$getPage(++this.page,s,function(n){e.onUploadedPage(n),t&&t()})},doSave:function(){var t=this.getDataStoring();return this.options.connector.$save(t)},afterLoadPage:function(t,e){}},t.NEKLO.ProductSorter=t.NEKLO.SimpleEventEmitter?t.NEKLO.SimpleEventEmitter.mixin(o):t.NEKLO.ProductSorter}(window,document,_,jQuery),function(t,e,n){t.NEKLO=t.NEKLO||{};var i=Class.create();i.prototype=Object.assign(Object.create(t.NEKLO.SorterElement.prototype),{initialize:function(e,n,i,a){this.el=t.NEKLO.SorterElement.call(this,e,n,i,a)},searchElementSibling:function(t,e){if(t)return"true"!==t.dataset.attached&&t.classList.contains(this.setups.className)?t:"next"===e?this.searchElementSibling(t.nextSibling,e):this.searchElementSibling(t.previousSibling,e)},handlerGoToPage:function(t){void 0==this.parent&&(t=this,t.$$instance);var e=jQuery(t).find(".to-page-inp")[0].value;if(e=parseInt(e)){var n=t.$$instance.getParentInstance(),i=n.sorter;i.page;var a=(i.totalItems/i.getPageSize()).ceil(),s=[],r=function(){if(s.length&&s.pop(),0==s.length){var a=i.getPageSize()*(e-1);a+=1;var r,o,d,l=null;+t.dataset.position>a?(r=a,o=+t.dataset.position,d=!1):(r=+t.dataset.position,o=a,d=!0),jQuery(t).find(".to-page-frm")[0].setStyle({display:"none"}),l=n.sortData(r,o,t,d),n.onListUpdated(l),i.emit&&i.emit(i.EVENTS.ON_ITEMS_CHANGED,l),n.page=e,n.updateList(i.getItemData(e),e,i.options.item),i.pager.updateState(e,i.totalItems)}};e>=1&&(e>1&&i.loadedPages.indexOf(e-1)<0&&(s.push(1),i.uploadData(e-1,r.bind(this))),e<a&&i.loadedPages.indexOf(e+1)<0&&(s.push(1),i.uploadData(e+1,r.bind(this))),i.loadedPages.indexOf(e)<0?(s.push(1),i.uploadData(e,r.bind(this))):r())}}});var a=Class.create();a.prototype=Object.assign(Object.create(t.NEKLO.SorterList.prototype),{initialize:function(e){this.el=t.NEKLO.SorterList.call(this,e)},sortDataByOrder:function(t,e,i){var a,s=!1;return n.forEach(t,function(t,n){!1===s&&(s=n),t.isDirty=!0,a&&(a.position=t.position),a=t,t.entity_id===e.dataset.entity_id&&(t.position=i+(isNaN(s)?0:s))}),t.sort(function(t,e){return+t.position-+e.position}),t},sortData:function(t,e,i,a){var s,r=t-1,o=e-1,d=this.sorter,l=d.pageItemsStorge;l=n.slice(l,r,o+1);n.clone(l,!0);return a?(s=e,l=l.reverse()):s=t,l=this.sortDataByOrder(l,i,s)},sortElements:function(t,e,i,a){var s=this,r=t-1,o=e-1,d=this.sorter,l=(this.page-1)*d.getPageSize();r-=l,o-=l;var c,p=this.getListElements();p=n.slice(p,r,o+1);var h=n.clone(p,!0);a?(c=e,p=p.reverse()):c=t,p=this.sortElementsByOrder(p,i,c),s.sortElementsInDOM(p,h),s.updateElementsState(),s.onListUpdated(p)},updateList:function(e,n,i){this.page=n,this.updateSetups=i,t.NEKLO.SorterList.prototype.updateList.call(this,e,i)},createListItems:function(t,e){var n=this,a=0,s=t.length,r=this.getListElement();r.innerHTML="";var o=0,d=function(){++o===s&&n.updateElementsState()};for(a;a<s;a++)if(void 0!==t[a].name){var l=new i(e,t[a],r,d);r.appendChild(l.el)}return r},updateElementsState:function(){var t=this.getListElements(),e=0;n.forEach(t,function(t){t.clientHeight>e&&(e=t.clientHeight)}),n.forEach(t,function(t){t.$$instance.updateElementState(t.dataset,e)})}});var s=Class.create();s.prototype={initialize:function(t){this.options=t||{};var n=t.separator,i=n.template,a=e.createElement(n.selector);return a.className=n.className,a.innerHTML=i,this.pageTemplate=$("template-paging-item").innerHTML,a.$$instance=this,a.$$instance.getElement=function(){return jQuery(a)},this.el=a,a},updateState:function(t,e){var n,a=this.options.grid.cols*this.options.grid.rows;if(this.pagesCount=Math.ceil(e/a),this.page=t,!(t>this.pagesCount)){if(1==this.pagesCount)return void $$(".nd-list__separator")[0].hide();this._preparePages(t);var s=1*this.getElement().attr("initialized"),r=jQuery(this.getElement().find(".page-left")[0]);t>1?(r.removeClass("disabled"),s||addEvent(r,"click",this.updatePage.bind(this))):r.addClass("disabled"),s||addEvent(r,"click",this.updatePage.bind(this)),r=jQuery(this.getElement().find(".page-right")[0]),t<this.pagesCount?(r.removeClass("disabled"),s||addEvent(r,"click",this.updatePage.bind(this))):r.addClass("disabled"),n=jQuery(this.getElement().find(".page")[0]),s?(n.find("option").removeAttr("selected"),n.find('option[value="'+t+'"]').prop("selected","selected")):(i.prototype.addPageOptions(n,this.pagesCount,t),addEvent(n,"change",this.updatePage.bind(this))),n.val(t);var o=this.getElement().find(".total-pages")[0];o.innerHTML=o.innerHTML.replace("%s",this.pagesCount),o=this.getElement().find(".total-items")[0],o.innerHTML=o.innerHTML.replace("%d",e),this.getElement().attr("initialized",1)}},_preparePages:function(t){var e=this.getElement().find(".pager-holder")[0],i=this.pagesCount;e.innerHTML="";var a,s=t-1,r=t+1;r>i&&(r=i,s=i-2,s=s<1?1:s),s<=1&&(s=1,r=Math.min(3,i));var o;if(s<=3)for(o=1;o<s;o++)a=n.template(this.pageTemplate)({page:o}),e.insert(a),a=e.children[e.children.length-1],o==t?a.addClassName("active"):addEvent(a,"click",this.uploadPage.bind(this));else a=n.template(this.pageTemplate)({page:"1"}),e.insert(a),a=e.children[e.children.length-1],addEvent(a,"click",this.uploadPage.bind(this)),a=n.template(this.pageTemplate)({page:"..."}),e.insert(a),a=e.children[e.children.length-1],a.setStyle({cursor:"default"});for(o=s;o<=r;o++)a=n.template(this.pageTemplate)({page:o}),e.insert(a),a=e.children[e.children.length-1],o==t?a.addClassName("active"):addEvent(a,"click",this.uploadPage.bind(this));if(r>=i-2)for(o=r+1;o<=i;o++)a=n.template(this.pageTemplate)({page:o}),e.insert(a),a=e.children[e.children.length-1],addEvent(a,"click",this.uploadPage.bind(this));else a=n.template(this.pageTemplate)({page:"..."}),e.insert(a),a=e.children[e.children.length-1],a.setStyle({cursor:"default"}),a=n.template(this.pageTemplate)({page:i}),e.insert(a),a=e.children[e.children.length-1],addEvent(a,"click",this.uploadPage.bind(this))},updateWidth:function(t){this.prototype.updateWidth.call(this,t)},updatePage:function(t){var e=this.page;if("click"==t.type){t.preventDefault();var n=1*t.target.readAttribute("data-move");if(1==e&&n<0)return;if(e==this.pagesCount&&n>0)return;e+=n}else"change"==t.type?e=1*t.target.value:13==t.charCode&&(e=1*t.target.value);this.onUploadPage(e)},uploadPage:function(t){t.preventDefault();var e=1*jQuery(t.target).attr("data-page");isNaN(e)||this.onUploadPage(e)}};var r=Class.create();r.prototype={initialize:function(t){t=t||{};var e=this;this.EVENTS=r.EVENTS,this.dataStoring=[],this.totalItems=t.totalItems,this.pageItemsStorge=this.initItems(t.categoryData),this.loadedPages=[],this.page=1,delete t.totalItems,this.options=n.merge(this.options,t);var i=this.getPageSize();return this.options.connector.$getPage(this.page,i,function(t){var n=e.options,i=n.targetDOM;if(!t.length)return r.createErrorElement(n);e.loadedPages.push(e.page),e.addItemData(t,e.page);var o=new a(n),d=new s(n);e.lister=o,e.pager=d,e.onUploadedPage=function(t){e.addItemData(t,e.page),o.updateList(e.getItemData(e.page),e.page,n.item),d.updateState(e.page,e.totalItems)},o.sorter=e,i.appendChild(o.el),i.appendChild(d.el),o.onListUpdated=e.updateDataStoring.bind(e),d.onUploadPage=e.uploadPage.bind(e),o.updateList(e.getItemData(e.page),e.page,n.item),d.updateState(e.page,e.totalItems),i.$$instance=e},function(e){r.createErrorElement(t,e)}),this},getPageSize:function(){return+this.options.grid.cols*+this.options.grid.rows},addItemData:function(t,e){for(var n=this.getPageSize(),i=(e-1)*n,a=(this.getDataStoring(),0);a<t.length;a++)this.pageItemsStorge[i+a]=t[a]},getItemData:function(t){var e=this.getPageSize();(t*=1)<1&&(t=1);for(var n=(t-1)*e,i=[],a=0;a<e;a++)void 0!=this.pageItemsStorge[n+a]&&i.push(this.pageItemsStorge[n+a]);return i},options:t.NEKLO.ProductSorter.prototype.options,createErrorElement:t.NEKLO.ProductSorter.createErrorElement,getDataStoring:function(){return this.dataStoring},updateDataStoring:function(t){var e=this,i=this.getDataStoring(),a=[],s=this.getPageSize();this.page;n.forEach(t,function(t){var s=t.dataset?t.dataset:t;if(n.find(e.pageItemsStorge,function(t,e){return+t.entity_id==+s.entity_id&&(t.position=+s.position,t.attached=s.attached,t.isDirty=s.isDirty,!0)}),"true"===s.isDirty){var r=n.find(i,function(t){if(t.entity_id===s.entity_id)return t});r?r=Object.assign(r,s):i.push(s),a.push(s)}}),this.pageItemsStorge.sort(function(t,e){return t.position>e.position?1:e.position>t.position?-1:0}),this.emit&&this.emit(this.EVENTS.ON_ITEMS_CHANGED,a)},uploadData:function(t,e){var n=this,i=this.options,a=i.grid.cols,s=i.grid.rows,r=+a*+s;i.connector.$getPage(t,r,function(i){n.addItemData(i,t),n.loadedPages.push(t),e&&e()})},uploadPage:function(t,e){var n=this,i=this.options,a=i.grid.cols,s=i.grid.rows,r=+a*+s;this.loadedPages.indexOf(t)>-1?this.pageSkip?e&&e():(n.page=t,n.lister.updateList(n.getItemData(n.page),n.page,i.item),n.pager.updateState(n.page,n.totalItems)):i.connector.$getPage(t,r,function(i){n.page=t,n.loadedPages.push(n.page),n.onUploadedPage(i),e&&e()})},initItems:function(t){var e,n=[];return t.position.each(function(i){e={entity_id:i.key,position:i.value,attached:"1"==t.attached.get(i.key)},n.push(e)}),n.sort(function(t,e){return t.position>e.position?1:e.position>t.position?-1:0}),n},doSave:function(){var t=this.getDataStoring();return this.options.connector.$save(t)}},r.EVENTS=t.NEKLO.ProductSorter.EVENTS,t.NEKLO.ProductPager=t.NEKLO.SimpleEventEmitter?t.NEKLO.SimpleEventEmitter.mixin(r):t.NEKLO.ProductPager}(window,document,_),function(t,e,n){function i(i){var i=i||{},a={topId:"top_scroll_page",bottomId:"bottom_scroll_page",height:"20px"};i=n.extend(i,a);var s=e.createElement("div");s.setAttribute("id",i.topId),s.innerHTML="&nbsp;";var r=e.createElement("div");r.setAttribute("id",i.bottomId),r.innerHTML="&nbsp;";var o=e.querySelector("body"),d=[];d.push(s,r);var l,c,p={dragEnter:function(t){t.preventDefault&&t.preventDefault();this.getAttribute("id"),i.topId;return!1},dragOver:function(e){e.preventDefault&&e.preventDefault();var n=t.scrollY,a=this.getAttribute("id")===i.topId?-1:1,s=-1===a?l:c,r=-1===a?n:o.clientHeight-(n+t.screen.height);if(void 0!=s&&s==r&&r>0){var d=n+50*a;t.scrollTo(0,d)}return-1==a?l=r:c=r,!1},hide:function(t){return n.forEach(d,function(t){t.style.display="none"}),!0},show:function(t){return n.forEach(d,function(t){t.style.display="block"}),!0}};n.forEach(d,function(t){o.insertBefore(t,o.childNodes[0]),t.style.display="none",t.style.position="fixed",t.style.left="0px",t.style.right="0px",t.style.zIndex=99999,t.style.height=i.height,addEvent(t,"dragenter",p.dragEnter),addEvent(t,"dragover",p.dragOver),addEvent(t,"mouseover",p.hide)}),s.style.top="0px",r.style.bottom="0px",addEvent(e,"dragstart",p.show),addEvent(e,"dragend",p.hide)}t.dnd_page_scroll=i}(window,document,_)});
