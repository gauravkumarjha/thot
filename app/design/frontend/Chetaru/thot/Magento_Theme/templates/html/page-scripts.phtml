<div class="Whatsapp-icon"><a href="https://api.whatsapp.com/send?phone=+919251877500&amp;text=Hey there, I am looking forward to getting in touch with you!!" target="_blank" rel="nofollow noopener noreferrer external" data-wpel-link="external">
        <img src="/pub/media/whatsapp-di.png" alt="Connect Over Whatsapp - thehouseofthings" title="The house of things">
    </a></div>
<!-- Popup -->

<style type="text/css">
    .checkout-payment-method.disabled {
        pointer-events: none;
        opacity: 0.6;
    }

    .checkout-shipping-method,
    .checkout-shipping-address .shipping-information {
        opacity: 0.5;
        pointer-events: none;
    }

    .checkout-shipping-address.valid .shipping-information {
        opacity: 1;
        pointer-events: auto;
    }

    
    div#fc_frame {
        display: none !important;
    }


    a#return-to-top {
        display: none !important;
    }

    .Whatsapp-icon {
        position: fixed;
        right: 20px;
        bottom: 73px;
    }

    .Whatsapp-icon img {
        max-width: 40px;
    }

    .checkout-payment-method .payment-method+.payment-method .payment-method-title {
        padding-bottom: 40px;
        border-top: 1px solid #ccc;
    }

    .phonepe-payment-icon {
        height: 22px;
        vertical-align: middle;
        margin-top: 6px;
    }

    .checkout-payment-method .payment-method-title .payment-icon {
        display: block;
        margin-right: 5px;
        vertical-align: middle;
        height: 22px;
        width: auto;
        margin-top: 6px;
    }

    .checkout-payment-method .payment-method-title {
        padding: 27px 0;
    }

    /* Display none for coding */
    form.quickrfq .form-group.col-md-3.field.code {
        display: none;
    }

    .checkout-container-vendor-gk-store-1 .shippingaddress_gk_2 {
        display: none;
    }

    .chetaru_edit-index-view .edit-content div[data-content-type='text'],
    .chetaru_edit-index-view .edit-content div[data-content-type="banner"] {
        padding-left: 20px;
        padding-right: 20px;
        max-width: 1180px;
        margin: 0px auto 0px;
        width: 100%;
    }

    .inedit_banner_above_description p {
        width: 800px;
        margin: 0px auto;
        background: #e8e8e8;
        padding: 25px 20px 25px 20px;
        margin-bottom: 32px;
        font-size: 22px;
    }

    .inedit_banner_above_description:first-of-type p {
        padding: 25px 20px 0px 20px;
        /* Adjust padding as needed */
    }

    .checkout-onepage-success div#switcher-currency,
    .checkout-index-index div#switcher-currency {
        display: none !important;
    }

    tr.totals.charge {
        display: none;
    }

    .chat-fc-form-outer div.fc-form a.fc-button {
        background-color: #000 !important;
        color: rgb(255, 255, 255);
    }

    .chat-fc-form-outer p.fc-header {
        background: #000 !important;
        border-radius: 0px !important;
        font-size: 17px;
        font-family: cursive;
        font-weight: 500
    }

    .chat-fc-form-outer div.fc-form {
        background: #dfdfd6;
    }

    .chat-fc-form-outer {
        border: 4px solid #000;
    }

    .chat-fc-form .fc-form>p {
        font-size: 14px;
    }

    .chat-fc-form-outer div.fc-form p {
        padding-top: 20px;
    }

    .chat-fc-form-outer div.fc-form ul li input {
        border: 1px solid #000 !important;
        border-radius: 0px;
        background: transparent;
    }

    .chat-fc-form-outer div.fc-form ul li label {
        font-weight: 500;
        padding: 0px 3px;
        background-color: #dfdfd6;
    }

    .chat-fc-form-outer div.fc-form ul li input {
        padding: 8px 8px;
    }

    .chat-fc-form-outer li.pre-fc-field select {
        border: 1px solid #000 !important;
        background: transparent;
        height: 33px;
    }

    .chat-fc-form-outer .pre-fc-error {
        text-align: left;
        font-size: 12px;
    }

    .chat-fc-form-outer div.fc-form p {
        font-weight: 500;
    }

    @media (min-width: 1020px) {
        body .ves-megamenu.ves-dvertical-right .navigation .level0.nav-2.submenu-left.subhover>.submenu {
            left: 50% !important;
        }

        .ves-megamenu .nav-item.active>a {
            color: #000;
        }

        .nav-4 .dropdown-menu {
            max-width: 665px;
            float: right;
            right: 0;
            margin: 0;
        }

        .nav-4 .dropdown-menu .pagebuilder-column {
            width: 40% !important;
            padding-right: 40px;
        }

        .nav-4 .dropdown-menu .pagebuilder-column:last-child {
            width: 60% !important;
        }

        body .page-wrapper {
            padding-top: 155px;
        }
    }

    @media screen and (max-width: 767px) {
        .home-page-slider .slick-track {
            display: flex;
        }

        .home-page-slider .slick-slide {
            height: auto;
        }

        .home-page-slider .slick-slide:has(.first-video-item) :where(div, .first-video-item .slider-img, .slider-img a, video) {
            height: 100% !important;
        }

        .first-video-item .slider-img video {
            object-fit: cover;
        }
    }


    @media (max-width: 767px) {
        .ves-megamenu>.navigation .nav-item.active>a {
            color: #000;
        }

        .field.search {
            position: relative !important;
        }

        span.input-group-btn {
            position: absolute !important;
            right: 43px !important;
        }

        form.form.minisearch button.btn {
            display: block !important;
        }

    }
</style>


<script>
    require(['jquery'], function($) {

        $('#comingsoon-form').on('submit', function(e) {
            e.preventDefault();

            var form = $(this);
            var formData = form.serialize();

            $.ajax({
                url: '<?= $block->getUrl("comingsoon/index/submit") ?>',
                type: 'POST',
                data: formData,
                showLoader: true,
                success: function(response) {
                    $('#comingsoon-response').html('<span style="color:green;">Thank you! We will contact you soon.</span>');
                    form[0].reset();
                },
                error: function() {
                    $('#comingsoon-response').html('<span style="color:red;">Something went wrong! Please try again.</span>');
                }
            });

        });

    });
</script>

<script src="https://snippets.freshchat.com/js/fc-pre-chat-form-v2.js"></script>
<script src="https://in.freshchat.com/js/widget.js" async></script>
<script>
    window.prechatTemplate = {
        "SubmitLabel": "Start Chat",
        "fields": {

            "0": {
                "error": "Please Enter a valid name",
                "fieldId": "name",
                "label": "Name",
                "required": "yes",
                "type": "text",
                "value": "Gaurav"
            },
            "1": {
                "error": "Please Enter a valid Email",
                "fieldId": "email",
                "label": "Email",
                "required": "yes",
                "type": "email"
            },
            // "2": {
            //     "error": "Please select a country code",
            //     "fieldId": "country_code",
            //     "label": "Country Code",
            //     "required": "yes",
            //     "type": "dropdown",
            //     "placeholder": "+91 0006543210",
            //     "options": [
            //         "+91", "+1", "+971", "+44", "+65", "+966", "+965", "+973", "+968", "+61",
            //         "+62", "+974", "+93", "+355", "+213", "+376", "+244", "+54", "+374", "+43",
            //         "+994", "+880", "+375", "+32", "+501", "+229", "+975", "+591", "+387", "+267",
            //         "+55", "+673", "+359", "+226", "+257", "+855", "+237", "+1", "+238", "+236",
            //         "+235", "+56", "+86", "+57", "+269", "+242", "+243", "+506", "+385", "+53",
            //         "+357", "+420", "+45", "+253", "+593", "+20", "+503", "+240", "+291", "+372",
            //         "+268", "+251", "+679", "+358", "+33", "+241", "+220", "+995", "+49", "+233",
            //         "+30", "+502", "+224", "+245", "+592", "+509", "+504", "+36", "+354", "+98",
            //         "+964", "+353", "+972", "+39", "+81", "+962", "+7", "+254", "+686", "+996",
            //         "+856", "+371", "+961", "+266", "+231", "+218", "+423", "+370", "+352",
            //         "+261", "+265", "+60", "+960", "+223", "+356", "+692", "+222", "+230", "+52",
            //         "+691", "+373", "+377", "+976", "+382", "+212", "+258", "+95", "+264", "+674",
            //         "+977", "+31", "+64", "+505", "+227", "+234", "+850", "+389", "+47", "+92",
            //         "+680", "+507", "+675", "+595", "+51", "+63", "+48", "+351", "+40", "+7",
            //         "+250", "+685", "+378", "+239", "+221", "+381", "+248", "+232", "+421",
            //         "+386", "+677", "+252", "+27", "+82", "+211", "+34", "+94", "+249", "+597",
            //         "+46", "+41", "+963", "+886", "+992", "+255", "+66", "+670", "+228", "+676",
            //         "+216", "+90", "+993", "+688", "+256", "+380", "+598", "+998", "+678",
            //         "+379", "+58", "+84", "+967", "+260", "+263"
            //     ]

            // },
            "2": {
                "error": "Include country code. Example: +91 2345678901",
                "fieldId": "phone",
                "label": "Phone",
                "required": "yes",
                "type": "phone",
                "placeholder": "+91 0006543210"
            },

        },
        "heading": "Chat with Us",
        "mainbgColor": "#0aa4db",
        "maintxColor": "#fff",
        "textBanner": "We can't wait to talk to you. But first, please take a couple of moments to tell us a bit about yourself.",

    };
    window.fcSettings = {
        onInit: function() {


            // window.fcWidget.on("user:created", function(userData) {
            //     // userData.firstName me form se submit hua "Name" hota hai
            //     const name = userData.firstName;
            //     console.log("User submitted name:", name);

            //     // Example: custom event track kar sakte ho
            //     window.fcWidget.track("prechat_name_submitted", {
            //         name: name
            //     });
            // });

            // 2️⃣ Phir pre-chat form init karo


            window.fcPreChatform.fcWidgetInit(window.prechatTemplate);



            const interval = setInterval(function() {
                var nameInputEl = document.querySelector('#chat-fc-name');
                var emailInputEl = document.querySelector('#chat-fc-email');
                var phoneInputEl = document.querySelector('#chat-fc-phone');
                //  var phoneInputcountryCodeEl = document.querySelector('#chat-fc-countrycode');
                var fcbutton = document.querySelector('.fc-button');


                var nameValue = nameInputEl?.value.trim() || '';
                var emailValue = emailInputEl?.value.trim() || '';
                var phoneValue = phoneInputEl?.value.trim() || '';
                //var phoneCountryCodeValue = phoneInputcountryCodeEl?.value.trim() || '';

                var siteName = document.querySelector('#quickrfq_form #company')?.value.trim() || '';
                var siteLastName = document.querySelector('#quickrfq_form #contact_name')?.value.trim() || '';
                var siteEmail = document.querySelector('#quickrfq_form #email')?.value.trim() || '';
                var sitePhone = document.querySelector('#quickrfq_form #phone')?.value.trim() || '';
                var sitecountryCode = document.querySelector('#quickrfq_form #country_code')?.value.trim() || '+91';
                var messageFieldValue = document.querySelector('#quickrfq_form #overview')?.value.trim();

                if (nameInputEl && siteName) {
                    console.log("Setting name:", siteName);
                    nameInputEl.value = siteName + " " + siteLastName;
                    nameInputEl.dispatchEvent(new Event('input', {
                        bubbles: true
                    }));
                }

                if (emailInputEl && siteEmail) {
                    emailInputEl.value = siteEmail;
                    emailInputEl.dispatchEvent(new Event('input', {
                        bubbles: true
                    }));
                }
                // if (phoneInputcountryCodeEl && sitecountryCode) {
                //     phoneInputcountryCodeEl.value = sitecountryCode;
                //     phoneInputcountryCodeEl.dispatchEvent(new Event('change', {
                //         bubbles: true
                //     }));
                // }
                var phoneVald = false;
                if (phoneInputEl && sitePhone) {
                    const isValidPhone = /^\d{10,20}$/.test(sitePhone); // 10 to 20 digits only
                    if (isValidPhone) {
                        phoneInputEl.value = sitecountryCode + "-" + sitePhone;
                        phoneInputEl.dispatchEvent(new Event('input', {
                            bubbles: true
                        }));
                        phoneVald = true;
                    } else {
                        console.warn("Invalid phone number (must be 10-20 digits):", sitePhone);
                    }
                }

                // Stop checking once all fields are filled
                if (
                    nameInputEl?.value.trim() &&
                    emailInputEl?.value.trim() &&
                    phoneVald
                ) {
                    clearInterval(interval);



                }
            }, 300);





        }
    };
    window.fcWidgetMessengerConfig = {
        config: {
            content: {
                actions: {
                    tab_chat: "Chat"
                },
                headers: {
                    chat: "Chat With Us"
                }
            },
            cssNames: {
                expanded: "custom_fc_expanded",
                widget: "custom_fc_frame"
            }
        }
    };
</script>

<script>
    require([
        'jquery'
    ], function($) {
        console.log("gaurav window.spConfig");
        console.log(window.spConfig);
        console.log("gaurav window.spConfig");

        window.fcWidget.on("status:change", function(resp) {
            console.log("Freshchat status:", resp.status);

            if (resp.status === "online") {
                // At least one agent is online
                console.log("✅ Chat is online");
                // You can update UI here
            } else if (resp.status === "offline") {
                // No agents available
                console.log("❌ Chat is offline");
                // Show message like: "Our team is currently offline"
            }
        });
        $(document).on('click', '.more_info_btn', function() {

            //   window.fcWidget.user.clear();

            if (window.fcWidget && window.fcWidget.open) {
                console.log("✅ Chat is online001");
                window.fcWidget.open();
            } else {
                console.warn("Freshchat widget not ready yet.");
            }


        });

        $(document).on('click', '.popupStartChat', function() {

            //   window.fcWidget.user.clear();

            $('.custom-theme-popup').removeClass('active');
            $('body').removeClass('popup-active');

            if (window.fcWidget) {
                var siteName = document.querySelector('#quickrfq_form #company')?.value.trim() || '';
                var siteLastName = document.querySelector('#quickrfq_form #contact_name')?.value.trim() || '';

                if (siteName) {
                    var namess = siteName + " " + siteLastName;
                }
                var messageFieldValue = document.querySelector('#quickrfq_form #overview')?.value.trim() || '';

                window.fcWidget.open({
                    name: namess || "support",
                    replyText: messageFieldValue || ''
                });

                // Optionally display the message using welcome message logic or bot


                // You may also want to display a welcome message to prompt the agent/bot
                window.fcWidget.user.setProperties({
                    "Initial Message": messageFieldValue
                });


                window.fcPreChatform.on_fc_pre_form_submit();


                console.log("✅ Chat is online001");
                window.fcWidget.open();
            } else {
                console.warn("Freshchat widget not ready yet.");
            }




        });

    });
</script>

<!-- <script src='//in.fw-cdn.com/32060972/1097811.js' widgetId='fefccc02-e640-427c-a884-641a22646277' chat=' true'></script> -->

<div class="popup_newsletter">


    <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <div class="col-md-6 col-xs-12 subscribeImage">

            <div class="row">
                <p>
                    <img src="/pub/media/wysiwyg/sign-up-pop-up.jpg" alt="">
                </p>
            </div>
        </div>
        <div class="col-md-6 col-xs-12 subscribe-form">

            <h2>STAY UPDATED</h2>
            <hr class="hr--small">
            <h2 class="newsletterSubhead">The House of Things is a curated online destination to discover and shop for
                luxury interiors.</h2>

            <?php
            echo $this->getLayout()
                ->createBlock('Magento\Cms\Block\Block')
                ->setBlockId('popup-newsletter')
                ->toHtml();
            ?>
            <p> Sign up and be the first to know about new arrivals and latest offers, delivered straight to your inbox.
            </p>
        </div>
    </div>

</div>
<style>
    span.product-item-pcb-master {
        display: flex;
        justify-content: space-between;
        padding-bottom: 10px;
    }

    .chat-fc-form-outer p.fc-header .fc-minimize {
        font-family: 'Work Sans', sans-serif !important;
    }

    @media screen and (max-width: 769px) {
        .fine-prints-slider .pagebuilder-mobile-hidden {
            display: none !important;
        }

        .fine-prints-slider .pagebuilder-mobile-only {
            display: block !important;
        }
    }
</style>









<?php $objectManager = \Magento\Framework\App\ObjectManager::getInstance(); ?>
<?php

$objectManager = \Magento\Framework\App\ObjectManager::getInstance();
// Get Store Currency
$storeManagers_log = $objectManager->get(\Magento\Store\Model\StoreManagerInterface::class);
$currencyCode_log = $storeManagers_log->getStore()->getCurrentCurrencyCode();

// Get country code from Cloudflare header
$countryCode_log = $_SERVER['HTTP_CF_IPCOUNTRY'] ?? 'Unknown';
$ipAddress_log = 'UNKNOWN';

// Priority: CF > X_FORWARDED_FOR > REMOTE_ADDR
if (!empty($_SERVER['HTTP_CF_CONNECTING_IP'])) {
    $ipAddress_log = $_SERVER['HTTP_CF_CONNECTING_IP'];
} elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
    // Might contain: "51.81.245.209, 127.0.0.1"
    $ipList = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);
    $ipAddress_log = trim($ipList[0]); // get the first IP
} elseif (!empty($_SERVER['REMOTE_ADDR'])) {
    $ipAddress_log = $_SERVER['REMOTE_ADDR'];
}
// Optional: Convert country code to full country name

// Logging
$writer = new \Zend_Log_Writer_Stream(BP . '/var/log/visitor_info.log');
$custom_logger = new \Zend_Log();
$custom_logger->addWriter($writer);

$custom_logger->info($ipAddress_log . " - " . $countryCode_log . " - " . $currencyCode_log);
// $storeManager = $objectManager->get('Magento\Store\Model\StoreManagerInterface');
// $currencyCode = $storeManager->getStore()->getCurrentCurrency();
// $currency = $objectManager->create('Magento\Directory\Model\CurrencyFactory')->create()->load($currencyCode);
// $currencySymbol = $currency->getCurrencySymbol();
$currencySymbol = "";
?>



<script>
    function httpGetAsync(url, callback) {
        const xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
            if (xmlHttp.readyState === 4 && xmlHttp.status === 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("GET", url, true); // true for asynchronous
        xmlHttp.send(null);
    }

    function getDomainFromEmail(email) {
        var regex = /@([^\s@]+)/;
        var matches = email.match(regex);
        if (matches && matches.length > 1) {
            return matches[1];
        }
        return null;
    }

    function isEmailValid(email) {
        // Regular expression for basic email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        return emailRegex.test(email);
    }

    function isEmailDomainBanned(email) {
        // Define your list of banned domains
        const bannedDomains = ['example.com', 'example.org', 'example.net', 'yopmail.com'];

        // Check if the email is valid
        if (!isEmailValid(email)) {
            return false; // Invalid email format
        }

        // Extract the domain from the email
        const emailParts = email.split('@');
        const domain = emailParts[1];

        // Check if the domain is in the list of banned domains
        return bannedDomains.includes(domain);
    }


    const phoneInput = document.querySelector("#phone");
    const emailInput = document.querySelector("#email");
    const phoneFull = document.querySelector("#phone_full");

    // const iti = window.intlTelInput(phoneInput, {
    //     utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.3.4/js/utils.min.js",
    //     preferredCountries: ["in", "us"],
    //     separateDialCode: true,
    //     nationalMode: false,
    // });

    const resetPhone = () => {
        phoneInput.classList.remove("mage-error");
        document.getElementById("RMIPopupSubmitBtn").disabled = false;
    };


    const errorPhone = () => {
        document.getElementById("RMIPopupSubmitBtn").disabled = true;
        phoneInput.classList.add("mage-error");
    };

    const resetEmail = () => {
        emailInput.classList.remove("mage-error");
        document.getElementById("RMIPopupSubmitBtn").disabled = false;
    };

    const errorEmail = () => {
        document.getElementById("RMIPopupSubmitBtn").disabled = true;
        emailInput.classList.add("mage-error");
    };

    // on click button: validate
    phoneInput.addEventListener("input", () => {
        let phone_num = phoneInput.value.trim();
        if (phone_num) {
            if (iti.isValidNumber()) {
                let countryData = iti.getSelectedCountryData();
                let number = iti.getNumber();
                //  $.getJSON("https://phonevalidation.abstractapi.com/v1/?api_key=b9501a608fbc4d38982ca84e3a0d7c13&phone=14152007986", function(data) {
                //      console.log(data);
                //  })
                //  countryCode.value = countryData.priority + countryData.dialCode; 
                //  console.log(countryData);
                //  console.log(countryCode.value);
                //  console.log(number);
                phoneFull.value = number;

                let combine_value = '+' + countryData.dialCode + phone_num;
                if (combine_value == number) {
                    resetPhone();
                } else {
                    errorPhone();
                }
            } else {
                errorPhone();
            }
        } else {
            resetPhone();
        }
    });
    phoneInput.addEventListener("countrychange", function() {
        phoneInput.value = "";
        phoneInput.classList.remove("mage-error");
    });


    // on click button: validate
    emailInput.addEventListener("input", () => {
        let emailValue = emailInput.value.trim();
        if (emailValue) {
            if (isEmailValid(emailValue)) {
                let isBanned = isEmailDomainBanned(emailValue);
                if (isBanned) {
                    errorEmail();

                } else {
                    resetEmail();
                }
            } else {
                errorEmail();
            }
        } else {
            resetEmail();
        }

    });
    // phoneInput.on("countrychange", function() {
    //     phoneInput.val('')
    // });

    // on keyup / change flag: reset
    //phoneInput.addEventListener('change', reset);
    //phoneInput.addEventListener('keyup', reset);

    function setCookie(cname, cvalue, exdays) {
        const d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        let expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
        let name = cname + "=";
        let ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    function checkCookie() {
        let user = getCookie("username");
        if (user != "") {
            alert("Welcome again " + user);
        } else {
            user = prompt("Please enter your name:", "");
            if (user != "" && user != null) {
                setCookie("username", user, 365);
            }
        }
    }
    requirejs(['jquery', 'slick'], function($) {

        <?php if ($block->getRequest()->getFullActionName() === 'cms_index_index'): ?>
            if (getCookie('popup_newsletter_closed')) {

            } else {
                setTimeout(function() {
                    $('.popup_newsletter').addClass('active');
                }, 15000);
            }
        <?php endif; ?>
        $('.popup_newsletter .close').click(function() {
            setCookie('popup_newsletter_closed', 'yes', 30);
            $('.popup_newsletter').removeClass('active');
        });
        $(".popup_newsletter form").submit(function() {
            setCookie('popup_newsletter_closed', 'yes', 30);
        });
        $('.popup_newsletterform .input').keypress(function(e) {
            if (e.which == 13) {
                setCookie('popup_newsletter_closed', 'yes', 30);
            }
        });

        var slideDuration = 8000; // 5 seconds per slide
        $('.home-page-slider').slick({
            infinite: true,
            slidesToShow: 1,
            slidesToScroll: 1,
            autoplay: true,
            autoplaySpeed: slideDuration,
        });
        if ($(window).width() < 1024) {
            $('.fine-items-slider').slick({
                slidesToShow: 1,
                slidesToScroll: 1,
                arrows: true,
                autoplay: false,
                infinite: false,
            });
        }
        $("a.more_info_btn_bottom").click(function() {
            var header_h = $('.page-header').outerHeight(true);
            $('html,body').animate({
                scrollTop: $(".product-info-detail").offset().top - header_h
            }, 'slow');
        });

        $(".popup_anchor").click(function() {
            $('.custom-theme-popup').addClass('active');
            $('body').addClass('popup-active');
        });
        $(".custom-theme-popup .close").click(function() {
            $('.custom-theme-popup').removeClass('active');
            $('body').removeClass('popup-active');
        });

        $("#RMIPopup #prefer_contact").change(function() {
            if ($(this).val() == 'Email') {
                $("#RMIPopup #email").addClass('required-entry');
                $("#RMIPopup #phone").removeClass('required-entry');
                $("#RMIPopup #phone").removeClass('mage-error');

            } else if (($(this).val() == 'WhatsApp') || ($(this).val() == 'Call')) {
                $("#RMIPopup #phone").addClass('required-entry');
                $("#RMIPopup #email").removeClass('required-entry');
            } else {
                $("#RMIPopup #email").removeClass('required-entry');
                $("#RMIPopup #phone").removeClass('required-entry');
            }
        });
    });
</script>


<script>
    require([
        'jquery',
        'Magento_Customer/js/customer-data'
    ], function($, customerData) {

        $(document).on('click', '.action.primary.continue', function() {
            // Load cart data
            var cart = customerData.get('cart')();
            var customeremail = $(document).find("#customer-email").val();
            var firstname = $(document).find("[name='firstname']").val();
            var lastname = $(document).find("[name='lastname']").val();
            // Load customer data
            var customer = customerData.get('customer')();
            //var email = customer.email || 'guest';
            var email = customer.email || customeremail;
            var firstname = firstname || 'Guest';
            var lastname = lastname || 'Guest';
            if (email != "") {
                // Prepare cart data
                var cartTotal = cart.subtotalAmount;
                var cartItems = cart.items || [];

                var itemCount = cart.summary_count;
                var itemsDetail = cartItems.map(function(item) {
                    return {
                        product_id: item.product_id,
                        name: item.product_name,
                        sku: item.product_sku,
                        price: item.product_price_value,
                        qty: item.qty
                    };
                });

                $.ajax({
                    url: '/utility/index/submitfreshwork',
                    type: 'POST',
                    data: {
                        email: email,
                        firstname: firstname,
                        lastname: lastname
                    },
                    success: function(response) {
                        console.log('Freshworks response:', response);

                        if (response.success) {
                            FM.associateVisitor(email);
                            FM.trackCustomEvent("AbandonedCart", {
                                email: email,
                                price: cartTotal,
                                cart_items_count: itemCount,
                                items: JSON.stringify(itemsDetail)
                            });
                        } else {
                            console.error('Freshworks error:', response.error);
                        }
                    }
                });


                console.log("Abandoned Cart Tracked", {
                    user_email: email,
                    cart_value: cartTotal,
                    cart_items_count: itemCount,
                    items: itemsDetail
                });
            }
        });

    });
</script>

<!-- End Popup -->
<!--Start of Tawk.to Script-->

<?php /* 27-08-2024 */ ?>
<!-- <script type="text/javascript">
    var Tawk_API = Tawk_API || {},
        Tawk_LoadStart = new Date();
    (function() {
        var s1 = document.createElement("script"),
            s0 = document.getElementsByTagName("script")[0];
        s1.async = true;
        s1.src = 'https://embed.tawk.to/59a92a00c28eca75e461d7ea/default';
        s1.charset = 'UTF-8';
        s1.setAttribute('crossorigin', '*');
        s0.parentNode.insertBefore(s1, s0);
    })();
</script> -->
<?php /* 27-08-2024 */ ?>
<!-- <script type="text/javascript">
    var Tawk_API = Tawk_API || {},
        Tawk_LoadStart = new Date();
    (function() {
        var s1 = document.createElement("script"),
            s0 = document.getElementsByTagName("script")[0];
        s1.async = true;
        s1.src = 'https://embed.tawk.to/6641d0409a809f19fb3039c9/1htohaves';
        s1.charset = 'UTF-8';
        s1.setAttribute('crossorigin', '*');
        s0.parentNode.insertBefore(s1, s0);
    })();
</script> -->
<!--End of Tawk.to Script-->

<script>
    require(['jquery'], function($) {
        jQuery(document).ready(function() {
            var takelihref = jQuery('.header-right-section > .header.links > li.authorization-link > a')
                .attr('href');
            var takelitxt = jQuery('.header-right-section > .header.links > li.authorization-link > a')
                .text();
            jQuery('.navigation .nav-item.customer-account a').attr("href", takelihref);
            //console.log(takelitxt, takelihref);
            jQuery('.navigation .nav-item.customer-account a span').text(takelitxt);
            jQuery('.desktop-nav-toggle').click(function() {
                jQuery("body").addClass("open-desktop-menu");
            });
            //alert(jQuery(window).width());
            if (jQuery(window).width() < 1000) {
                jQuery("#switcher-currency").insertAfter(".ves-megamenu nav.navigation");
            } else {
                jQuery('.account-menu-toggle').click(function() {
                    jQuery(".header-right-section ul.header.links").toggle();
                    return false;
                });
            }


            if (jQuery('body').hasClass('cms-collaboration-rhea-kapoor')) {
                jQuery(".play-image").on("click", function() {
                    jQuery("#yt-video").attr("src", jQuery("#yt-video").attr('data-src'));
                    jQuery("#yt-video").show();
                    jQuery(".play-image").hide();
                });
                var twoColumnText = jQuery('.two-column-text');
                var offset = twoColumnText.offset().top - 100; // Adjust the offset value as needed

                jQuery(document).on('scroll', function() {
                    var scrollPosition = jQuery(document).scrollTop();
                    if (scrollPosition > offset) {
                        twoColumnText.addClass('fixed-menu');
                    } else {
                        twoColumnText.removeClass('fixed-menu');
                    }
                });

                jQuery('.two-column-text a').click(function() {
                    jQuery(".two-column-text a").removeClass('active');
                    jQuery(this).addClass('active');
                    var href = jQuery(this).attr('href');
                    href = href.replace("#", ".");
                    var maincont = jQuery(".page-header").outerHeight(true);
                    // if( href == '#shop-section'){
                    var scrolldiv = $(href).offset().top
                    var res = scrolldiv - maincont - maincont;
                    $('html,body').animate({
                        scrollTop: res
                    }, 'slow');
                    //}
                })

                // $(window).scroll(function() {
                //     var video_off = $('.single-full-video.intro-section').offset.top;
                //     var video_h = $('.single-full-video.intro-section').outerHeight(true);
                //     ///alert(video_off + ' ' + video_h );
                // });
            }
        });
    });
</script>
<?php


$customerSession = $objectManager->get('Magento\Customer\Model\Session');
if ($customerSession->isLoggedIn()) {
    // customer login action
?>
    <script>
        require(['jquery'], function($) {
            jQuery(document).ready(function() {
                jQuery("body").addClass("customer-loggedin");
            });
        });
    </script>
<?php
} else {
?>
    <script>
        require(['jquery'], function($) {
            jQuery(document).ready(function() {
                jQuery("body").addClass("customer-loggedout");
            });
        });
    </script>
<?php
}

$urlInterface = $objectManager->create('Magento\Framework\UrlInterface');
//echo $urlInterface->getCurrentUrl();

if ((strpos($urlInterface->getCurrentUrl(), '/checkout') !== false)) {
?>



    <script type="text/javascript">
        require([
            'jquery',
            'Magento_Checkout/js/model/totals',
            'Magento_Checkout/js/action/get-totals',
            'Magento_Customer/js/customer-data',
            'Magento_Checkout/js/model/quote',
        ], function($, totals, getTotalsAction, customerData, quote) {
            console.log("GauravTestDone");
            setTimeout(function() {
                var deferred = $.Deferred();
                totals.isLoading(true); // Show loader if any

                getTotalsAction([], deferred); // Trigger totals refresh

                $.when(deferred).done(function() {
                    totals.isLoading(false);

                    // Totals object now updated
                    console.log('Updated Totals:', quote.totals());
                    console.log('Quote Currency:', quote.totals().quote_currency_code); // Should be USD
                    console.log('Base Currency:', quote.totals().base_currency_code); // Should be USD

                    // Stop any Magento loader
                    $('body').trigger('processStop');
                    $('#checkout-loader').remove(); // Fallback

                    // Invalidate and reload cart-related sections
                    var sections = ['cart', 'checkout-data'];
                    customerData.invalidate(sections);
                    customerData.reload(sections, true);

                });
                console.log("GauravTestDone");
            }, 3000); // 3000 milliseconds = 3 seconds
        });
    </script>




    <script type="text/javascript">
        require([
            'jquery',
            'Magento_Checkout/js/model/quote',
            'Magento_Checkout/js/model/totals',
            'Magento_Checkout/js/action/get-totals',
            'Magento_Customer/js/customer-data',
            'Magento_Checkout/js/model/step-navigator'
        ], function($, quote, totals, getTotalsAction, customerData, stepNavigator) {



            var currencySymbol = "<?php echo $currencySymbol ?>";

            // $(document).on('change', '#co-shipping-form select[name="country_id"]', function() {
            //     var selectedCountry = $(this).val();
            //     if (selectedCountry) {
            //         //updateCurrencydi(selectedCountry); 04-06-2025
            //     }
            // });

            function updateCurrencydi(countryCode) {
                $.ajax({
                    url: '/currencySwitcher/index/change',
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        country_id: countryCode
                    },
                    success: function(data) {
                        if (data.success) {
                            var currencyCode = data.currency_code;
                            var currencyRate = parseFloat(data.rate);
                            var isRateSet = data.rate_set;
                            currencySymbol = data.currency_symbol;

                            if (isRateSet) {

                                // Update currency code in quote totals (optional logic)
                                //quote.totals().quote_currency_code = currencyCode;

                                // Recalculate totals

                                quote.totals().quote_currency_code = currencyCode;
                                quote.totals().base_currency_code = currencyCode;

                                var deferred = $.Deferred();
                                totals.isLoading(true);
                                getTotalsAction([], deferred);
                                console.log(quote.totals());
                                console.log(quote.totals().quote_currency_code); // Should be USD
                                console.log(quote.totals().base_currency_code); // Should be USD
                                $.when(deferred).done(function() {
                                    totals.isLoading(false);

                                    // Remove Magento checkout loader
                                    $('body').trigger('processStop');
                                    $('#checkout-loader').remove(); // Optional if above doesn't remove

                                    // Reload customer sections (only valid ones)
                                    var sections = ['cart', 'checkout-data'];
                                    customerData.invalidate(sections);
                                    customerData.reload(sections, true);
                                });


                                // $.when(deferred).done(function() {
                                //     totals.isLoading(false);
                                //     $('#currency-symbol').text(currencySymbol);
                                //     $(document).find("div#checkout-loader").remove();
                                //     // Update currency symbol in UI

                                //     // Invalidate customerData sections
                                //     var sections = ['cart', 'checkout-data'];
                                //     customerData.invalidate(sections);
                                //     customerData.reload(sections, true);



                                //     // Reload customer data sections
                                //     // var sections = ['cart'];
                                //     // customerData.invalidate(sections);
                                //     // customerData.reload(sections, true);
                                // });

                                setTimeout(function() {
                                    console.log(jQuery(document).find($('.cart-price .price')).length)
                                    $('.cart-price .price').each(function() {
                                        var priceHtml = $(this).html();
                                        console.log('Before:', priceHtml);
                                        priceHtml = priceHtml.replace(/₹|€|\$|£/g, currencySymbol);
                                        $(this).html(priceHtml);
                                        console.log('After:', $(this).html());
                                    });
                                }, 1000); // Delay for 1 second to let Magento finish rendering prices

                            } else {
                                console.warn('Currency rate not set for ' + currencyCode);
                            }
                        } else {
                            console.error('Failed to update currency.');
                        }
                    },
                    error: function() {
                        console.error('Error updating currency. Please try again later.');
                    }
                });
            }


            $(document).on('click', '.button.action.continue.primary', function() {
                // Disable the button to prevent multiple clicks
                var nextStepIndex = stepNavigator.getActiveItemIndex() + 1;

                // Wait for the next step to load and then reload
                var checkStep = setTimeout(function() {
                    if (stepNavigator.getActiveItemIndex() === nextStepIndex) {
                        // location.reload(); 04-06-2025
                        // setTimeout(function() {
                        //     console.log(jQuery(document).find($('.cart-price .price')).length)
                        //     $('.cart-price .price').each(function() {
                        //         var priceHtml = $(this).html();
                        //         console.log('Before:', priceHtml);
                        //         priceHtml = priceHtml.replace(/₹|€|\$|£/g, currencySymbol);
                        //         $(this).html(priceHtml);
                        //         console.log('After:', $(this).html());
                        //     });
                        // }, 1000); // Delay for 1 second to let Magento finish rendering prices
                        // clearTimeout(checkStep);
                    }
                }, 1000); // 1000ms delay before checking the next step
            });

            function updateCurrencySymbolInUI(symbol) {
                // Update all currency symbol placeholders
                $('[data-role=priceBox] .price').each(function() {
                    var priceHtml = $(this).html();
                    alert(symbol)
                    alert(priceHtml)
                    // Replace any existing currency symbol with the new one
                    priceHtml = priceHtml.replace(/₹|€|\$|£/g, symbol);
                    $(this).html(priceHtml);
                });

                // Update any custom currency symbol locations
                $('#currency-symbol, .currency-symbol, .custom-currency-symbol').text(symbol);
            }

        });
    </script>

    <script>
        require(
            [
                'Magento_Checkout/js/model/quote',
                'Magento_Checkout/js/model/cart/totals-processor/default'
            ],
            function(
                quote,
                totalsDefaultProvider
            ) {
                totalsDefaultProvider.estimateTotals(quote.shippingAddress());
            }
        );

        require([
            'jquery',
            'Magento_Checkout/js/action/get-totals',
            'Magento_Checkout/js/model/quote',
            'Magento_Checkout/js/model/totals',
            'Magento_Checkout/js/model/cart/totals-processor/default',
            'Magento_Ui/js/modal/alert',
            'Magento_Customer/js/customer-data',
            'Magento_Checkout/js/action/select-payment-method',
            'Magento_Checkout/js/model/payment/method-list',
            'Magento_Checkout/js/action/get-payment-information',
            'mage/url',
            'Magento_Checkout/js/model/step-navigator',
            'jquery/ui',

        ], function($, getTotalsAction, quote, totals, defaultTotal, alert, customerData, selectPaymentMethodAction, paymentMethods, getPaymentInformation, url, stepNavigator) {
            var isPageLoad = true;
            $(document).ready(function() {




                // Selectors for shipping form fields
                var shippingFormSelector = 'form[data-role=shipping-form]';

                // Event listener for form submission or any input change
                $(shippingFormSelector).on('change input', 'input, select', function() {
                    // saveShippingFormToLocalStorage();
                });

                // Save shipping form data to localStorage
                function saveShippingFormToLocalStorage() {
                    var formData = {};

                    // Get all form fields
                    $(shippingFormSelector + ' input, ' + shippingFormSelector + ' select').each(function() {
                        var fieldName = $(this).attr('name');
                        var fieldValue = $(this).val();
                        if (fieldName) {
                            formData[fieldName] = fieldValue;
                        }
                    });

                    // Store the form data in localStorage
                    localStorage.setItem('shippingFormData', JSON.stringify(formData));
                    console.log('Shipping form data saved to localStorage:', formData);
                }

                // Load saved form data from localStorage
                function loadShippingFormFromLocalStorage() {
                    var savedData = localStorage.getItem('shippingFormData');
                    if (savedData) {
                        var formData = JSON.parse(savedData);

                        // Set the values for each field in the form
                        $.each(formData, function(fieldName, fieldValue) {
                            $('[name="' + fieldName + '"]').val(fieldValue).trigger('change');
                        });
                        console.log('Shipping form data loaded from localStorage:', formData);
                    }
                }

                // Load form data when the page is ready
                loadShippingFormFromLocalStorage();
            });

            var updateCodFee = function(paymentMethod) {
                // if (paymentMethod === 'cashondelivery') {
                // COD selected, send AJAX request to apply fee
                var paymentMethod = paymentMethod;
                $.ajax({
                    url: url.build('dimediacustomStatus/ajax/addCodFee'),
                    type: 'POST',
                    data: {
                        "payment_method": paymentMethod
                    },
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            // Refresh the totals section
                            getTotalsAction([], $.Deferred());

                            // Display fee message
                            var feeMessage = '<div class="cod-fee-message">' + response.message + '</div>';
                            if (!$('.cod-fee-message').length && response.paymentMethod == 'cashondelivery') {
                                $('.shipping:first').after(feeMessage); // Append message to totals section
                            } else {
                                $('.cod-fee-message').remove();
                                removeOrderSummaryFee();
                            }

                            // Update order summary
                            updateOrderSummary(response.fee);
                        }
                    }
                });
                // }

                // else {
                //     // Remove fee message if payment method is not COD
                //     $('.cod-fee-message').remove();
                //     removeOrderSummaryFee();
                // }
            };

            var updateOrderSummary = function(fee) {
                // Update the order summary with the COD fee
                var summarySection = $('.order-summary');
                var feeHtml = '<div class="cod-fee-summary"><strong>Cash on Delivery Fee:</strong> ₹' + fee + '</div>';
                if (!$('.cod-fee-summary').length) {
                    summarySection.append(feeHtml);
                }
            };

            var removeOrderSummaryFee = function() {
                $('.cod-fee-summary').remove();
            };

            // Trigger fee calculation for the initial page load
            var initCodFee = function() {
                var currentMethod = quote.paymentMethod();
                if (currentMethod && currentMethod.method) {
                    updateCodFee(currentMethod.method);
                }
            };



            // Monitor changes in payment method selection

            // Check if the step is loaded before adding fee
            stepNavigator.steps.subscribe(function(steps) {
                // Ensure checkout step has loaded
                if (steps && steps.length) {
                    initCodFee(); // Check fee after steps load
                }
            });




            // Recheck payment method on page load
            $(document).ready(function() {
                //initCodFee();
                quote.paymentMethod.subscribe(function(selectedPaymentMethod) {
                    console.log("Selected Payment Method:", selectedPaymentMethod.method);
                    if (selectedPaymentMethod && selectedPaymentMethod.method) {
                        updateCodFee(selectedPaymentMethod.method);
                    }
                });

                // var currentMethod = quote.paymentMethod() ? quote.paymentMethod().method : null;
                // if (currentMethod) {
                //     updateCodFee(currentMethod);
                // }


            });

            <?php
            $storeManager = $objectManager->get(\Magento\Store\Model\StoreManagerInterface::class);
            $currencyCode = $storeManager->getStore()->getCurrentCurrencyCode();
            // echo "Current Currency Code: " . $currencyCode;

            ?>
            if (!localStorage.getItem('thot_country_currency') && !localStorage.getItem('thot_country_code')) {
                localStorage.setItem('thot_country_currency', '<?php echo $currencyCode ?>');
                localStorage.setItem('thot_country_code', 'IN');
            }

            if (localStorage.getItem('thot_country_currency') != "<?php echo $currencyCode ?>") {
                localStorage.setItem('thot_country_currency', '<?php echo $currencyCode ?>');
            }



            var thot_country_code = localStorage.getItem('thot_country_code');
            var thot_country_currency = localStorage.getItem('thot_country_currency');

            if (getCountriesByCurrencyCode(thot_country_currency)[0] == "US") {
                localStorage.setItem('thot_country_currency_other', '');
                console.log("GauravgkUS - " + getCountriesByCurrencyCode(thot_country_currency));
            } else if (getCountriesByCurrencyCode(thot_country_currency).indexOf(thot_country_code) == -1) {
                console.log("Gauravgk - " + getCountriesByCurrencyCode(thot_country_currency));
                localStorage.setItem('thot_country_currency_other', 'other');
            } else {
                localStorage.setItem('thot_country_currency_other', '');
            }




            // var currencyCheckInterval = setInterval(function() {
            //     // Check if the currency code is not INR
            //     if ("<?php echo $currencyCode; ?>" !== "INR") {
            //         // Update the HTML of the specific elements
            //         jQuery(".product-item-pcb-master-dynamic_value").html("To Be Quoted");

            //         // Clear the interval to prevent further checks
            //         clearInterval(currencyCheckInterval);
            //     }
            // }, 500); // Check every 1000 milliseconds (1 second)

            // Optional: Set a timeout to stop the interval after a certain period
            // setTimeout(function() {
            //     clearInterval(currencyCheckInterval); // Stop checking after 10 seconds
            // }, 1000); // 10000 milliseconds = 10 seconds
            //         $(document).on('change', '#co-shipping-form select[name="country_id"]', function(e) {
            //             // setTimeout(function() {

            //             if (isPageLoad) {
            //                 // Skip the first time when the page loads
            //                 isPageLoad = false;
            //                 return;
            //             }
            //             jQuery(document).find("body").append(`
            //     <div id="checkout-loader" data-role="checkout-loader" class="loading-mask">
            //         <div class="loader">
            //             <img src="https://stage.thehouseofthings.com/pub/static/frontend/Chetaru/thot/en_US/images/loader-1.gif" alt="Loading..." style="position: absolute;">
            //         </div>
            //     </div>
            // `);

            //             var selectedCountry = $(this).val();
            //             if (selectedCountry != '') {
            //                 selectedCountry = selectedCountry;
            //             } else {
            //                 selectedCountry = thot_country_code;
            //             }
            //             //  if (thot_country_code)

            //             //  updateCurrency(selectedCountry);
            //             // }, 3000); // 3000 milliseconds = 3 seconds
            //         });

            function updateCurrency(countryCode) {
                var country_code_local = thot_country_code;
                localStorage.setItem('thot_country_code', countryCode);
                var country_currencyCode = thot_country_currency;

                $.ajax({
                    url: '/simpleshipping/ajax/simpleshipping',
                    data: {
                        country_code: countryCode,
                    },
                    type: 'post',
                    dataType: 'json',
                    success: function(data) {

                        //localStorage.setItem('thot_country_currency', data.currencyCode);

                        // window.alert(data.currencyCode);
                        // window.alert(country_currencyCode);

                        if (country_currencyCode != data.currencyCode) {
                            //window.alert(thot_country_currency);
                            localStorage.setItem('thot_country_currency', data.currencyCode);
                            location.reload();
                        } else if ((country_code_local != countryCode)) {
                            location.reload();
                        }
                        if (data.success) {
                            console.log(data.success);
                            if (data.message != "IN" || thot_country_currency != "INR") {
                                jQuery(document).find(".product-item-pcb-master-dynamic_value").html("To Be Quoted");
                            } else {

                                totals.isLoading(true);
                                var deferred = $.Deferred();
                                getTotalsAction([], deferred);
                                $.when(deferred).done(function() {
                                    totals.isLoading(false);
                                    var sections = ['cart'];
                                    customerData.invalidate(sections);
                                    customerData.reload(sections, true);
                                });


                                jQuery(document).find(".minicart-items-wrapper-minicart .product-item").each(function($key, $value) {
                                    let customShippingCharge = data.order[$key];
                                    console.log("gjkjdjd-" + customShippingCharge);
                                    console.log(typeof customShippingCharge);
                                    if (typeof customShippingCharge === 'number' && !isNaN(customShippingCharge)) {

                                        // Assuming you want to add the currency symbol (e.g., $) before the number
                                        var formattedShippingCharge = '₹' + parseInt(customShippingCharge).toFixed(2);
                                        console.log(formattedShippingCharge);

                                    } else {
                                        var formattedShippingCharge = customShippingCharge;
                                    }
                                    jQuery($value).find(".product-item-pcb-master-dynamic_value").html(formattedShippingCharge);
                                });
                            }

                        } else {
                            alert({
                                title: 'Error',
                                content: 'Failed to update currency.'
                            });
                        }
                        jQuery(document).find("#checkout-loader").remove();
                    },
                    error: function() {
                        alert({
                            title: 'Error',
                            content: 'Error updating currency. Please try again later.'
                        });
                    }
                });

            }


            function getCountriesByCurrencyCode(currencyCode) {
                switch (currencyCode) {
                    case 'INR':
                        return ['IN']; // India
                    case 'GBP':
                        return ['GB', 'IO', 'FK', 'GS']; // British Pound territories
                    case 'AED':
                        return ['AE']; // United Arab Emirates
                    case 'EUR':
                        return [
                            'AX', 'AD', 'AT', 'BE', 'BQ', 'HR', 'CY', 'EE', 'FI', 'FR', 'GF', 'TF', 'DE',
                            'GR', 'GP', 'IE', 'IT', 'XK', 'LV', 'LU', 'MT', 'MQ', 'YT', 'MC', 'ME', 'NL',
                            'PT', 'RE', 'SM', 'ST', 'SK', 'SI', 'ES', 'BL', 'VA'
                        ]; // Eurozone countries and territories
                    default:
                        return ['US']; // Default to 'US' for USD if no mapping found
                }
            }

            // Example usage




        });
        require(['jquery'], function($) {
            let count = 0;

            setInterval(function() {
                count++;

                try {
                    // Retrieve data from localStorage
                    const jsonString = localStorage.getItem("mage-cache-storage");

                    // Check if data exists in localStorage
                    if (jsonString) {
                        try {
                            // Parse the JSON string into an object
                            const myObject = JSON.parse(jsonString);

                            // Log the parsed object
                            if (myObject['checkout-data'] &&
                                myObject['checkout-data']['shippingAddressFromData'] &&
                                myObject['checkout-data']['shippingAddressFromData']['country_id'] &&
                                myObject['checkout-data']['shippingAddressFromData']['country_id'] !== "IN") {

                                jQuery(document).find(".product-item-pcb-master-dynamic_value").html("To Be Quoted");
                            }

                            //  console.log("Parsed object:", myObject['checkout-data']['shippingAddressFromData']['country_id']);
                        } catch (parseError) {
                            // Handle JSON parsing errors
                            console.error("Error parsing JSON from localStorage:", parseError);
                        }
                    } else {
                        // Handle case where no data is found
                        console.warn("No data found in localStorage for key 'mage-cache-storage'.");
                    }
                } catch (error) {
                    // Handle errors accessing localStorage
                    console.error("Error accessing localStorage:", error);
                }

                // Uncomment the line below if you want to update the DOM element
                // document.getElementById('counter').textContent = count;
            }, 1000); // Updates every 1000ms (1 second)
        });



        requirejs([

            'Magento_Checkout/js/model/quote',
            'Magento_Checkout/js/model/shipping-rate-registry'
        ], function(mainQuote, rateReg) {
            ///$('#table-checkout-shipping-method input.radio').prop('checked', false);
            //  var address = mainQuote.shippingAddress();
            //     rateReg.set(address.getKey(), null);
            //     rateReg.set(address.getCacheKey(), null);
            //     mainQuote.shippingAddress(address);
        });
    </script>
    <script type="text/javascript">
        require([
            'jquery',
            'Magento_Checkout/js/model/quote',
            'Magento_Checkout/js/action/get-totals', // Ensures totals update
            'Magento_Customer/js/customer-data', // Required for cart data updates
            'knockout'
        ], function($, quote, getTotalsAction, customerData, ko) {

            // Track if the button was clicked to prevent reload or multiple triggers
            var buttonClicked = false;

            // Define observable for tracking the validity of the selected shipping method
            var isShippingMethodValid = ko.observable(false);

            // Function to handle currency update logic
            // function updateCurrency(countryCode) {
            //     localStorage.setItem('thot_country_code', countryCode);
            //     $.ajax({
            //         url: '/simpleshipping/ajax/simpleshipping',
            //         data: {
            //             country_code: countryCode
            //         },
            //         type: 'post',
            //         dataType: 'json',
            //         success: function(data) {

            //             var thot_country_currency = localStorage.getItem('thot_country_currency');
            //             localStorage.setItem('thot_country_currency', data.currencyCode);
            //             if (data.success) {
            //                 if (data.message !== "IN" || thot_country_currency !== "INR") {
            //                     $(".product-item-pcb-master-dynamic_value").html("To Be Quoted");
            //                 } else {
            //                     // Refresh totals
            //                     getTotalsAction([], $.Deferred().resolve());
            //                     customerData.invalidate(['cart']);
            //                     customerData.reload(['cart'], true);

            //                     // Update shipping charges dynamically in the mini cart
            //                     $(".minicart-items-wrapper-minicart .product-item").each(function(index, item) {
            //                         let customShippingCharge = data.order[index];
            //                         let formattedShippingCharge = typeof customShippingCharge === 'number' && !isNaN(customShippingCharge) ?
            //                             '₹' + parseInt(customShippingCharge).toFixed(2) :
            //                             customShippingCharge;
            //                         $(item).find(".product-item-pcb-master-dynamic_value").html(formattedShippingCharge);
            //                     });
            //                 }
            //             } else {
            //                 alert('Failed to update currency.');
            //             }
            //         },
            //         error: function() {
            //             alert('Error updating currency. Please try again later.');
            //         }
            //     });
            // }

            // Attach click event to "Next" button in the shipping method section
            // var thot_country_code = localStorage.getItem('thot_country_code');
            // var thot_country_currency = localStorage.getItem('thot_country_currency');

            // $(document).on("click", "#shipping-method-buttons-container .button", function() {
            //     if (!buttonClicked) { // Ensure it only triggers once per click
            //         buttonClicked = true;
            //         var currencyCode = thot_country_currency
            //         var thot_country_currency_other = localStorage.getItem('thot_country_currency_other');

            //         // Get the selected country from the shipping form
            //         var selectedCountry = $('#co-shipping-form select[name="country_id"]').val();
            //         if (thot_country_currency_other == "other") {
            //             updateCurrency(selectedCountry); // Trigger the currency update

            //             // Optional: Reset buttonClicked after a delay if necessary
            //             setTimeout(function() {
            //                 location.reload();
            //                 buttonClicked = false;
            //             }, 3000); // Adjust the delay if needed
            //         }
            //         // setTimeout(function() {
            //         //     window.location.href = "https://stage.thehouseofthings.com/checkout/#payment";
            //         // }, 100);
            //     }
            // });


        });
    </script>

    <style>
        .checkout-container-vendor-gk-store-3 .shippingaddress_gk {
            display: none;
        }

        .hem2top .minicart-wrapper,
        #block-shipping,
        #cart-totals tr.totals.sub,
        #cart-totals tr.totals.shipping {
            display: none
        }

        .hem2top .minicart-wrapper.onlyforcheckout {
            display: block !important;
        }

        #cart-totals {
            border-top: none;
        }

        .table-checkout-shipping-method .col-carrier {
            display: none;
        }

        .opc-block-summary .totals.shipping.excl .mark .value {
            display: none
        }

        .opc-block-summary .totals.shipping.excl .amount .price {
            font-size: 0;
        }

        .opc-block-summary .totals.shipping.excl .amount .price:after {
            font-size: 14px;
        }

        .opc-block-shipping-information .shipping-information-content span.value {
            font-size: 0;
        }

        .opc-block-shipping-information .shipping-information-content span.value:after {
            font-size: 14px;
        }

        .product-shipping {
            margin-top: 7px;
        }

        .product-item-pcb-master {

            font-weight: bold;
        }
    </style>
    <?php
    $cart = $objectManager->get('\Magento\Checkout\Model\Cart');


    ?>
    <script>

    </script>
    <?php

    // get quote items collection
    $itemsCollection = $cart->getQuote()->getItemsCollection();

    // get array of all items what can be display directly
    $itemsVisible = $cart->getQuote()->getAllVisibleItems();

    // get quote items array
    $items = $cart->getQuote()->getAllItems();
    if (!empty($items)) {
        $remove_free = false;
        $i = 1;
        foreach ($items as $item) {
            // echo 'ID: '.$item->getProductId().'<br />';
            //echo 'Name: '.$item->getName().'<br />';
            // echo 'Sku: '.$item->getSku().'<br />';
            // echo 'Weight: '.$item->getWeight().'<br />';
            // echo 'Quantity: '.$item->getQty().'<br />';
            // echo 'Price: '.$item->getPrice().'<br />';
            //echo "<br />";   
            if ($item->getWeight() > 0) {
                $remove_free = true;
                //break;
    ?>
                <style>
                    .minicart-items-wrapper .product-item:nth-child(<?php echo $i; ?>) .product-item-name-block:after {
                        /* content: "Shipping: To Be Quoted"; */
                        font-weight: bold;
                    }

                    #shopping-cart-table>.col-sm-12:nth-child(<?php echo $i; ?>) .cart-item-info .transparent-select-button:before {
                        /* content: "Shipping: To Be Quoted"; */
                        font-weight: bold;
                        width: 200px;
                        display: inline-block;
                    }
                </style>
            <?php
            } else {
            ?>
                <style>
                    .minicart-items-wrapper .product-item:nth-child(<?php echo $i; ?>) .product-item-name-block:after {
                        /* content: "Shipping: Free"; */
                        font-weight: bold;
                    }

                    #shopping-cart-table>.col-sm-12:nth-child(<?php echo $i; ?>) .cart-item-info .transparent-select-button:before {
                        /* content: "Shipping: Free"; */
                        font-weight: bold;
                        width: 200px;
                        display: inline-block;
                    }
                </style>
            <?php

            }
            $i++;
        }
        if ($remove_free) {
            //echo 'remove free';
            ?>
            <style>
                /* #checkout-step-shipping_method #checkout-shipping-method-load tr:nth-child(2){
                    display:none
                }  */

                .opc-block-summary .totals.shipping.excl .amount .price:after {
                    content: "To Be Quoted";
                }

                .table-checkout-shipping-method td.col-price {
                    display: none;
                }

                .opc-block-shipping-information .shipping-information-content span.value {
                    font-size: 14px;
                }

                /* tr.totals.shipping.incl span.value {
                    display: none;
                } */

                .opc-block-shipping-information .shipping-information-content span.value:after {
                    /* content: "Shipping: To Be Quoted (We will contact you in 48 hours)"; */
                }
            </style>
        <?php
        } else {
        ?>
            <style>
                /* #checkout-step-shipping_method #checkout-shipping-method-load tr:nth-child(1){
                    display:none
                } */
                .opc-block-summary .totals.shipping.excl .amount .price:after {
                    content: "Free";
                }

                .opc-block-shipping-information .shipping-information-content span.value:after {
                    content: "Shipping: Free";
                }
            </style>
<?php
        }
    }
}

?>

<style>
    /* remove configuration product more information */
    body.page-product-configurable .page-main.page-main-details {
        display: none !important;
    }
</style>
<div class="refreh-button-hard" style="display:none">

    <button onclick="location.reload(true);">Refresh</button>
</div>

<!-- add Css here  -->
<style>
    .swatch-option.text.selected.disabled2,
    .swatch-option.text.disabled2 {
        cursor: not-allowed;
        background: #eee !important;
        border: solid 1px #ccc;
    }
</style>

<script type="text/javascript">
    require(['jquery', 'Magento_Swatches/js/swatch-renderer'], function($) {


        setTimeout(() => {
            console.log($(document).find('.swatch-option').length + "length" + 1);
            if ($(document).find('.swatch-option').length > 0) {
                $(document).find('.swatch-option').each(function() {
                    var color = $(this).data('option-label');
                    if (color && color.startsWith('#')) {
                        $(this).css('background-color', color);
                    }
                });
            }
        }, 5000);



    });
</script>
<?php
//$objectManager = \Magento\Framework\App\ObjectManager::getInstance();
$request = $objectManager->get('Magento\Framework\App\Action\Context')->getRequest();

if ($request->getFullActionName() == 'catalog_product_view') {

    $product = $objectManager->get('Magento\Framework\Registry')->registry('current_product');
    if ($product->getTypeId() == 'configurable') {
        $data = $product->getTypeInstance()->getConfigurableOptions($product);
        $options = array();
        foreach ($data as $attr) {
            foreach ($attr as $p) {
                $product_chlid = $objectManager->get('Magento\Catalog\Api\ProductRepositoryInterface')->get($p['sku']);
                $status = $product_chlid->getData('status');
                $qty  = $product_chlid->getExtensionAttributes()->getStockItem()->getQty();
                $options[$product_chlid->getId()][$p['attribute_code']] = $p['value_index'];
                $options[$product_chlid->getId()]['stock'] = $qty;
                $options[$product_chlid->getId()]['status'] = $status . "-" . $p['value_index'];
                $options[$product_chlid->getId()]['stockmsg'] = $product_chlid->isAvailable() ? 'instock' : 'outofstock';
            }
        }



        if (!empty($options)) {
            foreach ($options as $key => $option) {
                echo "<span class='attribute_custom'";
                foreach ($option as $key => $value) {
                    if ($key == 'status') {
                        if (strpos($value, '1-') === false) {
                            $expl = explode('-', $value);
                            echo " data-disabled='true'";
                            echo " data-attribute='" . $expl[1] . "'";
                        }
                    } else {
                        echo " data-" . $key . "= '" . $value . "'";
                    }
                }
                echo "></span>";
            }
        }
?>

        <script type="text/javascript">
            require(['jquery', 'Magento_Swatches/js/swatch-renderer'], function($) {
                $('.attribute_custom[data-disabled=true]').each(function() {
                    var attr = $(this).attr("data-attribute");
                    $('.swatch-attribute-options .swatch-option[option-id=' + attr + ']').addClass('active');
                    $('.swatch-attribute-options .swatch-option[option-id=' + attr + ']').hide();
                });

                $('.swatch-attribute').each(function() {
                    var color = $(this).data('option-label');
                    if (color && color.startsWith('#')) {
                        $(this).css('background-color', color);
                    }
                });

            });
            require(['jquery'], function($) {

                if (jQuery('.product-options-bottom .col-md-12.out-of-stock').length > 0) {

                } else {
                    $(".product-options-bottom").before(
                        "<p class='stock_message stock_message-3' style='color: #da2037;text-transform: uppercase;font-weight: 700;margin-bottom: 30px;line-height: 1.1;font-size: 1.8rem;'></p>");
                    console.log("okkkk");
                    setTimeout(() => {
                        console.log(jQuery(document).find(".swatch-option").length);

                        jQuery(document).find(".swatch-option").each(function() {
                            if (jQuery(this).parent("div").find(".disabled").length > 0) {
                                jQuery(this).parent("div").find(".disabled").removeClass("disabled");
                            }
                        });
                    }, "1000");
                    $(document).on('click', '.swatch-option:not(.disabled2)', function() {
                        var values = [];
                        $('.swatch-attribute').each(function() {
                            values.push($(this).attr("data-attribute-code"));
                        });
                        ///alert(values);
                        jQuery(document).find(".swatch-option").each(function() {
                            if (jQuery(this).parent("div").find(".disabled").length > 0) {
                                jQuery(this).parent("div").find(".disabled").removeClass("disabled");
                            }
                        });
                        var html = '';
                        $.each(values, function(index, value) {
                            var select = $(".swatch-attribute[data-attribute-code=" + value + "]").attr(
                                'data-option-selected');
                            if (select === undefined) {
                                select = 0;
                            }
                            html += "[data-" + value + "=" + select + "]";
                        });
                        //alert(html);
                        var optionId = $(this).attr("option-id");
                        var parent = $(this).parents('.swatch-attribute').attr("data-attribute-code");
                        console.log($(".attribute_custom" + html).attr('data-stockmsg'))
                        if ($(".attribute_custom" + html).attr('data-stockmsg') == 'outofstock') {
                            $('p.stock_message').text('Out of stock');
                            $(this).addClass('disabled2');
                            $('.product-options-bottom').addClass('disabled');
                            $(document).find("#product-addtocart-button").attr("disabled", "true");
                        } else {
                            $('p.stock_message').text('');
                            $(document).find(".disabled2").removeClass("disabled2");
                            $('.product-options-bottom').removeClass('disabled');
                            $(document).find("#product-addtocart-button").removeAttr("disabled");
                        }
                    });
                }

            });
        </script>
<?php

    }
}
